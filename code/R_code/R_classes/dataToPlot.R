library(R6)
# ---- DataToPlot ----
DataToPlot <- 
  R6Class("DataToPlot",
           public = list(
             data = NULL,
             path = NULL,
             jobName = NULL,
             attributes = list(),
             plottingFlags = list(),
             actions = list(),
             gridResults = NULL,
             path_to_job = NULL,
             
             initialize = function(data, path, jobName = NULL, attributes = list(),
                                   plottingFlags = list(), actions = list(), gridResults = NULL) {
               self$data <- data
               self$path <- path
               self$jobName <- jobName
               self$attributes <- attributes
               self$plottingFlags <- plottingFlags
               self$actions <- actions
  
               if (!is.null(self$jobName)) {
                 self$path_to_job <- file.path(self$path, self$jobName)
               } else {
                 self$jobName <- "Job1"  # Default job name
                 self$path_to_job <- dirname(self$path)
               }
               
               if (is.null(gridResults)) {
                 stop("gridResults must be provided.")
               } else {
                 self$gridResults <- gridResults
               }
             },
             
             plotCreator = function() {
               stop("This method should be implemented in a subclass.")
             },
             
             getPredictor = function() {
               inputs <- self$inputs
               return(inputs$predictor)
             },
             
             inputsSetter = function() { # add more general details?
               stop("This
                    method should be implemented in a subclass.")
             }, 
             
             getInputtxt = function() {
               inputFilePath <- file.path(self$path_to_job, "inputs.txt")
               if (file.exists(inputFilePath)) { 
                 cat("input.txt found \n")
                 inputFile <- readLines(inputFilePath)
                 return(inputFile)
               } else {
                 cat("input.txt not found \n")
                 return(NULL)
               }
             },
             
             strToNum = function(str) {
               a <- as.numeric(strsplit(str, " ")[[1]])
               # cat(length(a), "\n")
               return(a)
             }, 
             
             summStatCalculator = function(data) {
               summStat <- sapply(data, function(x) {
                 hdi <- hdi(x, credMass = 0.95) |> unname() #  Compute the 95% highest density interval
                 quantiles <- quantile(x, c(0.25, 0.5, 0.75)) |> unname()
                 c(mean = mean(x),
                   sd = sd(x),
                   q05 = hdi[1],
                   q25 = quantiles[1],
                   median = quantiles[2],
                   q75 = quantiles[3],
                   q95 = hdi[2])
               }) |> t()
               
               # summStat <- sapply(data, function(x) { 
               #   quantiles <- quantile(x, c(0.05, 0.25, 0.5, 0.75, 0.95)) |> unname()
               #   c(mean = mean(x),
               #     sd = sd(x),
               #     q05 = quantiles[1],
               #     q25 = quantiles[2],
               #     median = quantiles[3],
               #     q75 = quantiles[4],
               #     q95 = quantiles[5]) }) |> t()  #quantile(x, probs = c(0.25, 0.5, 0.75)))) |> t()
               return(summStat)
             }
           )
)
# ---- DataToPlotSkyGrid ----
DataToPlotSkyGrid <- 
  R6Class("DataToPlotSkyGrid",
           inherit = DataToPlot,
           public = list(
             initialize = function(data, path, jobName = NULL, attributes = list(),
                                   plottingFlags = list(), actions = list(), gridResults = NULL) {
               defaultsPlotting <- list(
                 plottingDemographic = FALSE,
                 plottingDemographicCovariate = FALSE,
                 plottingDemographicGridCovariate = FALSE,
                 plottingDemographicGridCovariates = FALSE,
                 plottingHyperpar = FALSE, 
                 plottingDemographicMeanCovariate = FALSE
               )
               plottingFlags <- modifyList(defaultsPlotting, plottingFlags)
               defaultsActions <- list(
                 logPop = FALSE,
                 publicationQuality = FALSE,
                 useInputFile = TRUE, 
                 plotGmrfMean = FALSE
               )
               actions <- modifyList(defaultsActions, actions)
               # actions$logPop <- ifelse(is.null(actions$logPop), FALSE, actions$logPop)
               # actions$publicationQuality <- ifelse(is.null(actions$publicationQuality), FALSE, actions$publicationQuality)
               # cat("actions is:", actions$logPop, "|")
               super$initialize(data = data, path = path, jobName = jobName, attributes = attributes, 
                                plottingFlags = plottingFlags, actions = actions, gridResults = gridResults)
               cat("Loading data to plot Np Coalescent. Nrows=", nrow(self$data), "...\n")
               
             },
             
             plotCreator = function() {
               cat("Creating plots ... \n")
               # cat("dem plot is ", self$plottingFlags$plottingDemographic, "\n")
               self$data <- self$data %>%
                 rename_with(~ str_replace(., "skygrid\\.Pop", "PopSize")) # TODO CHANGE BACK "PopSize"
               # 
               # self$data <- self$data %>%
               #   rename_with(~ str_replace(., "branchRates.log.rates", "PopSize"))
               # self$data <- dplyr::select(self$data, 69:129)
               # print(names(self$data))
               
               
               # if (self$actions$plotGmrfMean) {
               #   self$data <- self$data %>% dplyr::select(-contains("PopSize"))
               #   self$data <- self$data %>%
               #     rename_with(~ str_replace(., "gmrf.mean", "PopSize"))
               #   self$actions$logPop <- FALSE
               #   # self$data <- self$data %>%
               #   #   mutate(across(contains("PopSize"), ~ . - gp.mean))
               #   self$data <- self$data %>%
               #     rowwise() %>%
               #     mutate(
               #       popsize_mean = mean(c_across(contains("PopSize"))),
               #       popsize_sd = sd(c_across(contains("PopSize")))
               #     ) %>%
               #     mutate(across(
               #       contains("PopSize"),
               #       ~ (. - popsize_mean)
               #     )) %>%
               #     ungroup() %>%
               #     dplyr::select(-popsize_mean, -popsize_sd)  # clean up helper columns
               # }
               
               
               if (self$actions$logPop) {
                 head(self$data)
                 self$data <- self$data %>%
                   mutate(across(contains("PopSize"), ~ log(.x / as.numeric(self$attributes$N0))))
               }
               summStat <- self$summStatCalculator(self$data)
               inputs <- self$inputsSetter()
               
               if (self$plottingFlags$plottingDemographic) {
                 cat("Plotting demography vs time\n")
                 cat(length(inputs$gridPoints))
                 self$gridResults$plottingDemographic[[self$jobName]] <- plotDemographicQuantiles(summStat, inputs$gridPoints, "Time", self$jobName, self$attributes, self$actions)
                 # self$gridResults$logRatesBoxPlots[[self$jobName]] <- boxPlotLogRates(self$data, inputs$logRates, inputs$predictor, self$jobName)
               }
               if (self$plottingFlags$plottingDemographicCovariate) {
                 cat("Plotting demography vs covariate\n")
                 self$gridResults$plottingDemographicCovariate[[self$jobName]] <- plotDemographicQuantiles(summStat, inputs$covariate, self$attributes$covariate, self$jobName, self$attributes, self$actions)
               }
               if (self$plottingFlags$plottingDemographicGridCovariate) {
                 cat("Plotting demography + covariate vs time grid\n")
                 self$gridResults$plottingDemographicGridCovariate[[self$jobName]] <- plotDemographicGridCovariateQuantiles(summStat, inputs$gridPoints, "Time", inputs$covariate, self$attributes$covariate, self$jobName, self$attributes, self$actions)
               }
               if (self$plottingFlags$plottingDemographicGridCovariates) {
                 cat("Plotting covariates\n")
                 # print(self$attributes$covariates)
                 for (cov in self$attributes$covariates) {
                   cat("plotting", cov)
                   self$gridResults$plottingDemographicGridCovariates[[cov]] <- plotDemographicGridCovariateQuantiles(summStat, inputs$gridPoints, "Time", inputs$covariates[[cov]], cov, self$jobName, self$attributes, self$actions)
                     # plotDemographicGridCovariateQuantiles(summStat, inputs$gridPoints, "GridPoints", cov, self$jobName)
                 }
                 # self$gridResults$plottingDemographicGridCovariates[[self$jobName]] <- plotDemographicGridCovariatesQuantiles(summStat, inputs$gridPoints, "GridPoints", inputs$covariates, self$jobName)
               }
               if (self$plottingFlags$plottingDemographicMeanCovariate) {
                 self$data <- self$data %>% dplyr::select(-contains("PopSize"))
                 self$data <- self$data %>%
                   rename_with(~ str_replace(., "gmrf.mean", "PopSize"))
                 self$actions$logPop <- FALSE
                 # self$data <- self$data %>%
                 #   mutate(across(contains("PopSize"), ~ . - gp.mean))
                 self$data <- self$data %>%
                   rowwise() %>%
                   mutate(
                     popsize_mean = mean(c_across(contains("PopSize"))),
                     popsize_sd = sd(c_across(contains("PopSize")))
                   ) %>%
                   mutate(across(
                     contains("PopSize"),
                     ~ (. - popsize_mean)
                   )) %>%
                   ungroup() %>%
                   dplyr::select(-popsize_mean, -popsize_sd)  # clean up helper columns
                 summStatMeanGmrf <- self$summStatCalculator(self$data)
                 cat("Plotting demography Mean vs covariate\n")
                 self$gridResults$plottingDemographicMeanCovariate[[self$jobName]] <- plotDemographicQuantiles(summStatMeanGmrf, inputs$covariate, self$attributes$covariate, self$jobName, self$attributes, self$actions)
               }
               return(self$gridResults)
             },
             
             inputsSetter = function() { 
               var_names <- c("gridPoints")
               inputs <- setNames(vector("list", length(var_names)), var_names)
               #cat(self$path_to_job)
               inputFilePath <- file.path(self$path_to_job, "inputs.txt")
               if (file.exists(inputFilePath) && self$actions$useInputFile) { 
                 cat("input file found \n")
                 inputFile <- readLines(inputFilePath)
                 for (var in var_names) {
                   ## TODO ADD FUNCTION EXTRACT VECTOR??? OK IF IT IS IN OPEN DATA
                   inputs[[var]] <- extract_vector(inputFile, var)
                 }
                 cat("end InputsSetter\n")
               } else {
                 cat("input file not found; setting inputs based on functions\n")
                 inputs$gridPoints <- self$loadGridPoints()
                 
                 inputs$covariate <- self$loadCovariate()
                 inputs$covariates <- self$loadCovariates()
                 cat("end InputsSetter\n")
               return(inputs)
               }
             }, 
             
             loadGridPoints = function() {
               cat("Loading gridPoints of length ")
               # TODO correct, at the beginning I added a gridPoint=0 to make it 60.
               # gridPoints <- "0 0.043835616438173 0.128767123287616 0.20547945205476 0.290410958903976 0.37534246575342 0.457534246575278 0.542465753424494 0.62465753424658 0.709589041095796 0.794520547945012 0.876712328767098 0.961643835616314 1.04383561643817 1.12876712328762 1.20547945205476 1.29041095890398 1.37534246575342 1.45753424657528 1.54246575342449 1.62465753424658 1.7095890410958 1.79452054794501 1.8767123287671 1.96164383561631 2.04383561643817 2.12876712328762 2.20547945205476 2.29041095881735 2.37511041236939 2.45707762548409 2.54177707903591 2.6237442921506 2.70844374570265 2.79314319925447 2.87511041236939 2.95980986592122 3.04177707903591 3.12647653258796 3.20571150526553 3.29041095890398 3.37534246575342 3.45753424657528 3.54246575342449 3.62465753424658 3.7095890410958 3.79452054794501 3.8767123287671 3.96164383561631 4.04383561643817 4.12876712328762 4.20547945205476 4.29041095890398 4.37534246575342 4.45753424657528 4.54246575342449 4.62465753424658 4.7095890410958 4.79452054794501 4.8767123287671" |> 
               if (self$attributes$tree == "YF") {   
                 # gridPoints <- "0.05 0.1 0.15 0.2 0.25 0.3 0.35 0.4 0.45 0.5 0.55 0.6 0.65 0.7 0.75 0.8 0.85 0.9 0.95 1 1.05 1.1 1.15 1.2 1.25 1.3 1.35 1.4 1.45 1.5 1.55 1.6 1.65 1.7 1.75 1.8 1.85 1.9 1.95 2 2.05 2.1 2.15 2.2 2.25 2.3 2.35 2.4 2.45 2.5 2.55 2.6 2.65 2.7 2.75 2.8 2.85 2.9 2.95 3"
                 gridPoints <- "0.043835616438173 0.128767123287616 0.20547945205476 0.290410958903976 0.37534246575342 0.457534246575278 0.542465753424494 0.62465753424658 0.709589041095796 0.794520547945012 0.876712328767098 0.961643835616314 1.04383561643817 1.12876712328762 1.20547945205476 1.29041095890398 1.37534246575342 1.45753424657528 1.54246575342449 1.62465753424658 1.7095890410958 1.79452054794501 1.8767123287671 1.96164383561631 2.04383561643817 2.12876712328762 2.20547945205476 2.29041095881735 2.37511041236939 2.45707762548409 2.54177707903591 2.6237442921506 2.70844374570265 2.79314319925447 2.87511041236939 2.95980986592122 3.04177707903591 3.12647653258796 3.20571150526553 3.29041095890398 3.37534246575342 3.45753424657528 3.54246575342449 3.62465753424658 3.7095890410958 3.79452054794501 3.8767123287671 3.96164383561631 4.04383561643817 4.12876712328762 4.20547945205476 4.29041095890398 4.37534246575342 4.45753424657528 4.54246575342449 4.62465753424658 4.7095890410958 4.79452054794501 4.8767123287671 5.00"
                 mrsd <- as.Date("2019-02-24")
                 mrsd_decimal_years <- decimal_date(mrsd)
                 gridPoints <- mrsd_decimal_years - as.numeric(strsplit(gridPoints, " ")[[1]]) 
                } else if (self$attributes$tree == "Dengue") {
                 gridPoints <- "0.083 0.167 0.250 0.333 0.417 0.500 0.583 0.667 0.750 0.833 0.917 1.000 1.083 1.167 1.250 1.333 1.417 1.500 1.583 1.667 1.750 1.833 1.917 2.000 2.083 2.167 2.250 2.333 2.417 2.500 2.583 2.667 2.750 2.833 2.917 3.000 3.083 3.167 3.250 3.333 3.417 3.500 3.583 3.667 3.750 3.833 3.917 4.000 4.083 4.167 4.250 4.333 4.417 4.500 4.583 4.667 4.750 4.833 4.917 5.000 5.083 5.167 5.250 5.333 5.417 5.500 5.583 5.667 5.750 5.833 5.917 6.000 6.083 6.167 6.250 6.333 6.417 6.500 6.583 6.667 6.750 6.833 6.917 7.000 7.083 7.167 7.250 7.333 7.417 7.500 7.583 7.667 7.750 7.833 7.917 8.000 8.083 8.167 8.250 8.333 8.417 8.500 8.583 8.667 8.750 8.833 8.917 9.000 9.083 9.167 9.250 9.333 9.417 9.500 9.583 9.667 9.750 9.833 9.917 10.000 10.083 10.167 10.250 10.333 10.417 10.500 10.583 10.667 10.750 10.833 10.917 11.000 11.083 11.167 11.250 11.333 11.417 11.500 11.583 11.667 11.750 11.833 11.917 12.000 12.083 12.167 12.250 12.333 12.417 12.500 12.583 12.667 12.750 12.833 12.917 13.000 13.083 13.167 13.250 13.333 13.417 13.500 13.583 13.667 13.750 13.833 13.917 14.000 14.083 14.167 14.250 14.333 14.417 14.500 14.583 14.667 14.750 14.833 14.917 15.000 15.083 15.167 15.250 15.333 15.417 15.500 15.583 15.667 15.750 15.833 15.917 16.000 16.083 16.167 16.250 16.333 16.417 16.500 16.583 16.667 16.750 16.833 16.917 17.000 17.2" # added 1
               } else if (self$attributes$tree == "Mox") {
                 gridPoints <- "3000 6000 9000 12000 15000 18000 21000 24000 27000 30000 33000 36000 39000 42000 45000 48000 51000 54000 57000 60000 63000 66000 69000 72000 75000 78000 81000 84000 87000 90000 93000 96000 99000 102000 105000 108000 111000 114000 117000 120000 123000 126000 129000 132000" 
                 gridPoints <- as.numeric(strsplit(gridPoints, " ")[[1]]) 
                 # |> sort(decreasing = TRUE)
                } else if (self$attributes$tree == "Rabies") {
                 gridPoints <- "4.950000 5.116667 5.200000 5.366667 6.283333 6.450000 6.950000 7.200000 7.283333 7.366667 7.450000 7.533333 7.700000 7.783333 8.033333 8.116667 8.200000 8.283333 8.366667 8.450000 8.533333 8.616667 8.700000 8.783333 8.866667 8.950000 9.033333 9.116667 9.200000 9.283333 9.366667 9.450000 9.533333 9.616667 9.700000 9.783333 9.866667 9.950000 10.033333 10.116667 10.200000 10.283333 10.366667 10.450000 10.533333 10.616667 10.700000 10.783333 10.866667 10.950000 11.033333 11.116667 11.200000 11.283333 11.366667 11.450000 11.533333 11.616667 11.700000 11.783333 11.866667 11.950000 12.033333 12.116667 12.200000 12.283333 12.366667 12.450000 12.533333 12.616667 12.700000 12.866667 12.950000 13.033333 13.116667 13.200000 13.283333 13.366667 13.450000 13.533333 13.616667 13.700000 13.783333 13.866667 13.950000 14.033333 14.116667 14.200000 14.283333 14.366667 14.533333 14.700000 14.783333 14.866667 14.950000 15.033333 15.116667 15.200000 15.366667 15.450000 15.533333 15.616667 15.700000 15.783333 15.950000 16.033333 16.116667 16.200000 16.283333 16.366667 16.450000 16.533333 16.616667 16.783333 16.866667 17.033333 17.366667 17.450000 17.533333 17.616667 17.783333 17.866667 18.033333 18.116667 18.283333 18.366667 18.533333 18.616667 18.700000 19.033333 19.116667 19.366667 19.450000 19.533333 19.616667 19.866667 19.950000 20.116667 20.200000 20.283333 20.366667 20.450000 20.533333 20.616667 20.700000 20.783333 20.950000 21.200000 21.283333 21.450000 21.533333 21.616667 21.700000 21.783333 22.033333 22.200000 22.283333 22.366667 22.450000 22.533333 22.616667 22.700000 22.950000 23.116667 23.200000 23.283333 23.366667 23.533333 23.616667 23.950000 24.033333 24.283333 24.866667 26.200000 27.00"
               } else if (self$attributes$tree == "Hiv") {
                 gridPoints <- "0.98 1.98 2.98 3.98 4.98 5.98 6.98 7.98 8.98 9.98 10.98 11.98 12.98 13.98 14.98 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31"
               }
              if (!is.numeric(gridPoints)) gridPoints <- self$strToNum(gridPoints)
              cat("There are ", length(gridPoints), "grid points...\n")

              return(gridPoints)
             }, 
             
             loadCovariate = function() {
               cat("Loading covariate ")
               if (self$attributes$tree == "YF") {
               # if (self$attributes$covariate == "Temperature") {
                 covariate = "0.3027211 0.4823447 0.7165678 1.534038 0.8174045 -0.1073073 -0.6599293 -1.170085 -2.4373 -2.00494 -1.771272 -1.050823 -0.2078454 0.5861498 0.04260229 0.446758 0.1998386 -0.3978539 0.1405105 -0.5242016 -1.733764 -2.607336 -1.57242 -1.149146 -0.1867545 0.3509135 0.7262176 0.9908103 0.6181554 0.1829303 0.2483409 0.1805948 -0.4508953 -0.9323415 -1.186877 -0.2391121 0.9106503 0.9733064 1.237353 0.72159 1.166837 1.305599 1.496124 1.267496 0.3240997 -0.1700388 -0.4288255 -0.3188713 0.3625393 0.5279674 0.8166514 1.448761 0.6148908 0.6079989 1.111351 0.8490195 -0.4291002 -1.223232 -0.8986986 -0.4501623"
                 self$attributes$covariate <- "Temperature"
                 # covariate = self$strToNum(covariate)
                # } 
               #   else if ( self$attributes$covariate == "ExpTemperature") {
               #   covariate = "0.3027211 0.4823447 0.7165678 1.534038 0.8174045 -0.1073073 -0.6599293 -1.170085 -2.4373 -2.00494 -1.771272 -1.050823 -0.2078454 0.5861498 0.04260229 0.446758 0.1998386 -0.3978539 0.1405105 -0.5242016 -1.733764 -2.607336 -1.57242 -1.149146 -0.1867545 0.3509135 0.7262176 0.9908103 0.6181554 0.1829303 0.2483409 0.1805948 -0.4508953 -0.9323415 -1.186877 -0.2391121 0.9106503 0.9733064 1.237353 0.72159 1.166837 1.305599 1.496124 1.267496 0.3240997 -0.1700388 -0.4288255 -0.3188713 0.3625393 0.5279674 0.8166514 1.448761 0.6148908 0.6079989 1.111351 0.8490195 -0.4291002 -1.223232 -0.8986986 -0.4501623"
               #   covariate <- exp(self$strToNum(covariate))
               # } else {
               #   stop("Covariate not recognized")
               # }
               } else if (self$attributes$tree == "Dengue") {
                 covariate <- "3.13549421592915 2.77258872223978 2.484906649788 3.58351893845611 3.40119738166216 2.19722457733622 1.79175946922805 0.693147180559945 1.79175946922805 2.07944154167984 2.07944154167984 1.38629436111989 3.29583686600433 3.55534806148941 2.39789527279837 2.39789527279837 2.89037175789616 2.70805020110221 2.39789527279837 1.6094379124341 1.38629436111989 1.6094379124341 1.6094379124341 1.38629436111989 1.79175946922805 1.09861228866811 2.30258509299405 2.30258509299405 2.19722457733622 1.09861228866811 1.6094379124341 1.38629436111989 1.09861228866811 2.19722457733622 1.38629436111989 2.484906649788 2.89037175789616 3.3322045101752 2.56494935746154 3.61091791264422 3.36729582998647 3.63758615972639 3.09104245335832 2.83321334405622 1.6094379124341 0.693147180559945 2.07944154167984 2.39789527279837 2.07944154167984 2.30258509299405 3.09104245335832 2.484906649788 1.79175946922805 2.07944154167984 1.6094379124341 0 1.38629436111989 0 0.693147180559945 0.693147180559945 1.38629436111989 1.79175946922805 2.39789527279837 2.07944154167984 2.77258872223978 3.04452243772342 1.94591014905531 1.6094379124341 1.6094379124341 0.693147180559945 1.94591014905531 2.19722457733622 2.56494935746154 3.3322045101752 3.29583686600433 2.39789527279837 2.19722457733622 1.79175946922805 2.56494935746154 1.38629436111989 0 1.38629436111989 1.09861228866811 1.38629436111989 2.19722457733622 2.89037175789616 2.19722457733622 2.30258509299405 1.94591014905531 1.38629436111989 0.693147180559945 0 0 0.693147180559945 0.693147180559945 1.6094379124341 2.19722457733622 2.39789527279837 2.56494935746154 2.77258872223978 0 1.79175946922805 1.09861228866811 0.693147180559945 0.693147180559945 1.09861228866811 0.693147180559945 1.09861228866811 2.07944154167984 2.89037175789616 3.13549421592915 3.40119738166216 3.66356164612965 2.77258872223978 2.19722457733622 1.6094379124341 1.79175946922805 1.94591014905531 1.79175946922805 1.79175946922805 1.38629436111989 1.38629436111989 1.38629436111989 1.09861228866811 1.79175946922805 2.99573227355399 2.77258872223978 2.19722457733622 1.6094379124341 2.39789527279837 2.83321334405622 2.56494935746154 2.56494935746154 3.36729582998647 2.94443897916644 3.85014760171006 4.00733318523247 3.04452243772342 2.30258509299405 1.09861228866811 0 0 0 0 0 1.09861228866811 0 2.07944154167984 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.693147180559945 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1.6094379124341 2.30258509299405 3.85014760171006 3.80666248977032 3.80666248977032 4.34380542185368 4.40671924726425 3.43398720448515 2.99573227355399 3.40119738166216 3.85014760171006 3.73766961828337 4.20469261939097 3.40119738166216 2.70805020110221 0 0 0 0 0 0 0 0 0 0"
                 self$attributes$covariate <- "Log isolate"
                 
               } else if (self$attributes$tree == "Mox") {
                 covariate <- "-34.9829237435009 -34.8111326034063 -34.7875697865353 -35.905 -38.2792083333333 -39.5028248587571 -40.6432283464567 -41.2097 -40.3944859813084 -41.1308333333333 -40.1056382978723 -39.3101020408163 -40.5629166666667 -40.0034722222222 -38.4827906976744 -39.7815625 -38.5078378378378 -38.8043333333333 -38.3958064516129 -40.45175 -40.8091176470588 -41.6965517241379 -39.7752777777778 -39.6125 -38.4489743589744 -39.1734285714286 -37.5202325581395 -37.0368292682927 -39.4696153846154 -38.4703333333333 -39.5370833333333 -38.9754166666667 -38.2776923076923 -37.1614285714286 -36.7815384615385 -37.5169565217391 -38.5457894736842 -37.7031578947368 -34.2303846153846 -34.892380952381 -35.9095 -37.000625 -32.8695 -33.4352631578947"
                  self$attributes$covariate <- "D18"
               } else if (self$attributes$tree == "Hiv") {
                 covariate <- "0.52 0.55 0.58 0.62 0.65 0.68 0.71 0.74 0.76 0.76 0.75 0.73 0.70 0.65 0.60 0.6 0.56 0.556 0.5556 0.55556 0.555556 0.5555556 0.46 0.446 0.4446 0.36 0.336 0.3336 0.26 0.226 0.2226"
                 self$attributes$covariate <- "Incidence"
               } else if (self$attributes$tree == "Rabies") {
                 covariate <- "1.114561 1.098838 1.093379 1.091787 1.071138 1.069841 1.05078 1.041594 1.040048 1.032361 1.018202 1.013034 1.011396 1.007029 1.002546 1.000147 0.9963444 0.9913218 0.9869364 0.9813094 0.9811141 0.970348 0.9675423 0.9536017 0.9497648 0.9458735 0.9431793 0.9410588 0.9357116 0.9283985 0.9107743 0.8945917 0.8876499 0.8674496 0.8652943 0.8508734 0.8484066 0.8467113 0.8411978 0.8176164 0.8105638 0.8083608 0.8031166 0.7983723 0.7975313 0.7836496 0.7705004 0.7636063 0.7590418 0.7490625 0.7425462 0.7330549 0.7276156 0.7018544 0.6913908 0.6787084 0.6642289 0.6486335 0.6338092 0.6309491 0.6209658 0.6167374 0.6060042 0.5964287 0.5765011 0.534281 0.5234012 0.5116614 0.4884341 0.4737783 0.4363611 0.402292 0.3831165 0.3724192 0.3651238 0.3572934 0.347927 0.3281552 0.3016765 0.2759474 0.2649981 0.2349197 0.2290227 0.2250931 0.207001 0.1918936 0.1565255 0.1397983 0.1089248 0.09421988 0.06603497 0.06142002 0.06132955 0.06022541 0.05499863 0.04718939 0.04391261 0.01916822 0.01298569 0.005138362 0.0001860512 -0.006168088 -0.02802554 -0.03491981 -0.03635839 -0.03830851 -0.04972285 -0.07050142 -0.07062282 -0.07510568 -0.07772076 -0.09255032 -0.09777338 -0.115857 -0.1167593 -0.1196543 -0.1397349 -0.1470672 -0.1733158 -0.176696 -0.2151404 -0.2251329 -0.2282972 -0.2345488 -0.2451242 -0.25492 -0.2605699 -0.2700267 -0.2849537 -0.2931931 -0.2965522 -0.3284914 -0.3337404 -0.3502205 -0.3518351 -0.3795474 -0.391078 -0.4056395 -0.450724 -0.4611887 -0.5008314 -0.5555021 -0.5742275 -0.5920277 -0.6845344 -0.6945221 -0.7082625 -0.7516351 -0.7805634 -0.8731632 -1.065522 -1.137801 -1.19696 -1.304426 -1.347768 -1.454566 -1.470742 -1.533172 -1.560663 -1.615263 -1.715415 -1.810248 -1.851039 -1.90547 -1.98275 -2.173124 -2.223458 -2.382428 -2.438384 -2.521081 -2.583118 -2.890754 -3.197027 -3.251473 -3.704129"
                 # covariate <- "13.3589345588321 13.3398164421675 13.3331775177452 13.3312417122171 13.3061344714447 13.3045570393534 13.2813799435817 13.270210404609 13.2683301413029 13.2589832495123 13.2417675019414 13.2354826907946 13.2334916024019 13.2281811998815 13.2227298616201 13.2198131557253 13.2151897350748 13.2090824921895 13.2037500775153 13.1969080329123 13.1966705390042 13.1835795305845 13.1801680475979 13.1632170066242 13.1585516261277 13.1538199486164 13.1505439565462 13.147965638578 13.1414637503345 13.1325714057437 13.1111414585457 13.0914643391876 13.0830234465849 13.0584610506522 13.0558404053459 13.0383053701943 13.0353059120799 13.0332445704342 13.0265404143491 12.997866787188 12.989291241591 12.9866125430687 12.9802359375447 12.9744670731308 12.9734445458929 12.9565652324459 12.9405765568135 12.9321936666582 12.9266435472693 12.9145092277153 12.9065858030489 12.8950449961021 12.8884310863704 12.8571069570831 12.8443838823451 12.8289628094797 12.8113565618021 12.7923934198729 12.7743679911747 12.7708902718428 12.7587511632969 12.7536096289615 12.7405586751981 12.7289154538241 12.704684613334 12.6533474522183 12.6401182652118 12.6258433982097 12.5976003375138 12.5797797099037 12.5342826040566 12.4928564871934 12.4695402165157 12.4565329029999 12.4476621906038 12.4381408850742 12.4267518347971 12.4027105041171 12.370513983017 12.3392288527815 12.3259151900526 12.289341574121 12.2821711990901 12.2773929976648 12.2553940495191 12.2370243752559 12.1940188090595 12.1736794557046 12.136139122841 12.1182587884577 12.0839875731194 12.0783760658002 12.0782660634342 12.07692348261 12.0705680331016 12.0610724511875 12.0570880708725 12.0270003322226 12.019482744301 12.009940844794 12.0039191228897 11.9961928590343 11.9696154661266 11.9612324398825 11.9594832061727 11.9571119756995 11.9432328004922 11.9179672768345 11.9178196634738 11.9123687582911 11.9091889813168 11.8911570920474 11.8848061573167 11.8628175019184 11.8617204141403 11.8582002240352 11.8337834381267 11.8248677736244 11.7929510310408 11.7888408962254 11.7420946655413 11.7299444352689 11.7260967703111 11.718495176994 11.7056360847432 11.6937249723678 11.6868550407196 11.6753561960786 11.6572057581201 11.647187169602 11.6431026284526 11.604266505425 11.5978840330554 11.5778451134695 11.5758819165455 11.5421853196188 11.5281648632221 11.5104588253144 11.4556387299563 11.442914268023 11.3947110350267 11.3282346998173 11.3054656533021 11.2838216238662 11.1713389305947 11.1591944833189 11.1424869794081 11.0897483360245 11.0545732140253 10.9419772443938 10.7080801506313 10.6201931905805 10.5482594928338 10.417586951647 10.3648855089707 10.235025672112 10.2153557922833 10.1394454483102 10.1060178224629 10.0396274650126 9.91784765100671 9.8025364677003 9.75293730005124 9.68675211284726 9.59278465594327 9.36130094023264 9.30009770869846 9.10679897848963 9.03875956624429 8.93820508617861 8.86277198009567 8.4887048240548 8.11629404342885 8.0500915872195 7.49968778245124"
                 self$attributes$covariate <- "Cumulative area"
               }
               covariate = self$strToNum(covariate)
               # covariate <- rev(covariate)
               cat(self$attributes$covariate, "of length ", length(covariate), "...\n")
               return(covariate)
             }, 
             
             loadCovariates = function() {
               cat("Loading covariates...\n ")
               if (self$attributes$tree == "YF") {
               wind_speed <- "-1.21495193546687 -1.18995765152049 -1.67794232546881 -2.47978889173934 -1.58102665803561 -0.476802892787966 -0.287249757152151 -1.32714899462921 -1.55289630203912 -1.74540175135201 -1.63287249131896 -0.96861053883037 -1.42002049223164 -1.43909349429791 -0.613643321950706 -0.467455768203423 -0.0420017316812033 1.00538694439834 1.21003120826854 1.01763679690131 0.869293759854527 0.245067715864307 -0.32681891627314 -0.331312342828578 0.472271344599128 0.0662120321336072 0.0311365368327352 0.4773306655969 0.328195474785529 0.857531140706487 1.52785607535775 1.32942389567536 1.124882613598 0.608575875891813 -0.0343321527417374 -0.0984516393698958 -0.0718421582005949 0.113180549009037 -0.966565171210304 1.12174303125905 0.0662582168344767 0.11833606642669 1.68519321753467 0.795985190830701 0.895487268608187 0.359460828872532 0.910794655063725 0.225306415336793 -0.687555741767694 -0.848948958464176 -0.142760873942745 -0.490295011990894 0.487973585654273 0.4649523216237 1.77865056466139 1.80082230675424 0.899906117079809 0.660478468254862 0.319525219806477 0.240861861420581 " 
               relat_humid_percent_variable_name <- "1.16339175543323 1.34689207928182 1.21920552289544 0.925191854167221 0.669505071664894 1.20788970472181 1.41344907601414 1.28255896543112 1.12126058836625 0.63070511386886 1.02166622765233 0.825214035016609 0.946536753205201 0.899126307552142 0.861768429086707 0.666986292019333 0.783049520839661 0.495852736002261 -0.00933764371348475 -0.930367553485222 -0.0751234101703441 0.0908478964946127 0.387438863156261 0.704872803405544 0.507797782175022 0.291593746620178 0.167219048196912 -0.0399223210609458 0.430536964525504 0.389697349216163 -0.118301423173365 -1.02411010028948 -1.06779352134324 -0.878366699117546 0.0570764861538453 -0.168666017758637 -0.878044966339532 0.180857551641838 -0.0984760690849192 0.653826758612374 -0.0663277987785902 -0.221526242171522 -1.76857897884423 -1.93165407665931 -2.61873417986047 -1.07567218527407 -0.63135188407054 0.190984200640219 0.460977162709895 0.750477939050951 0.372677120414714 -0.892426211069696 0.236505830556613 0.000974690756390541 -2.44302255798152 -2.29398438252625 -2.13183407528696 -0.548380502235669 -0.521655544921697 -0.920953882328926 " 
               pre_mm_day_variable_name <- "0.712567205774826 0.953904202987002 1.31356770224851 1.48853664077397 0.49171515849256 0.638759349676205 0.91737426869539 0.374531532788107 -0.291334735371713 -0.766083021460178 0.0045541591102895 -0.263754420798476 0.236642189766956 1.01475331318316 0.994824318540383 1.18470815406046 0.935153696120041 0.861601031628383 0.228903045952325 -0.978598784995009 -0.741017948111311 -1.8344913253576 -0.915255080625345 0.0175580848987146 -0.17315498148415 0.415949701539888 0.414611393121688 0.531116880357681 0.906396211294621 1.04457415955189 0.413960135407642 -0.63891299157404 -0.996422681129147 -1.70783883044632 -0.252385705382114 -0.869531016529801 -0.946549062673652 0.573602168833686 0.348035864478264 1.47185142521916 0.834262057911938 0.774870998476478 -0.359908914488751 0.0425595725119446 -2.34252312531888 -1.35903250471142 -1.67333193781538 0.0160207706598638 0.24487565967341 1.00792657255227 1.05249190886834 0.133871720923578 0.88844087240046 1.11789461212328 -0.1520459338179 -1.12446728155356 -2.43742296103627 -0.410446980542886 -1.95391036254388 -1.41454615283557 " 
               evi_variable_name <- "1.32372030965187 1.83403834486577 1.76757623411013 1.62210616111416 1.33796541657477 1.55018674168887 0.645032356263322 0.623416620286522 0.398776270579122 0.267498765884541 0.26125214332034 0.555303129014217 0.67575552788959 0.759420502615642 0.475535772245904 0.508082230355223 0.544523367491533 0.178341778974525 -0.917772644610046 -1.18684648011232 -1.24882929411659 -0.676824403578208 -0.272900807685724 -0.0176134636869493 0.299434491280548 0.549172587037604 0.689824801444935 0.855851527247665 0.686718113678666 -0.0155447156570982 -1.0335032083237 -1.5391230319943 -1.42331077915839 -0.971824907854034 -0.526410071382706 -0.0945897492821621 0.211149645707306 0.664964402410646 0.885538789069972 0.92224528513757 0.631603214136835 -0.216738915827667 -1.23873966390964 -1.88424005826939 -1.56339051250957 -0.882298685135519 -0.246862220282986 0.40206545946465 0.531613500443179 0.686521365092588 0.714648578263581 0.5075069755369 0.51214060397271 -0.786252545648851 -2.05313240495035 -2.00188458008787 -1.81242544802911 -1.33175154977749 -0.834582074413167 -0.302138796567336 " 
               temp_celsius_variable_name <- "0.302721062365908 0.482344748487265 0.71656778286309 1.53403759952926 0.817404516337528 -0.10730732710368 -0.659929297681808 -1.17008455780511 -2.43730046354652 -2.00494002302965 -1.77127192802424 -1.05082341746693 -0.207845438234293 0.586149793180624 0.0426022856972311 0.446758016858998 0.199838580566488 -0.39785389171922 0.140510454041102 -0.524201595251857 -1.73376400556605 -2.60733552033162 -1.57241976800754 -1.14914646336238 -0.186754519923211 0.350913537396001 0.726217609503476 0.99081034597048 0.618155376912772 0.182930251638331 0.248340884207028 0.180594803007582 -0.450895264757284 -0.932341525345489 -1.18687739211217 -0.239112061049147 0.910650257327585 0.973306448273949 1.23735322237016 0.721589993295889 1.16683673819061 1.3055988427665 1.49612426205878 1.26749560367613 0.324099721325033 -0.170038766388812 -0.428825458061236 -0.318871279924323 0.362539297787331 0.527967444941775 0.816651449145483 1.44876144430791 0.614890776288627 0.607998896450517 1.11135138614553 0.84901945437196 -0.429100162731543 -1.2232318528406 -0.898698624920965 -0.450162282101263 " 
               long_wave_radiation <- "0.812255994102679 0.866164499444966 0.827907912015215 0.679374119883235 0.537876501697654 0.909853288488253 1.00429540027743 0.772349410222417 0.754790458681822 0.348004457317605 0.692702191224393 0.31215267615277 0.387324845079481 0.626783907338642 0.638201596088388 0.625279267407317 0.644188804598229 0.532358200893016 0.203965021536296 -2.4061140846822 -0.161342982423935 -0.185186561235166 0.0738043320271245 0.478432162427485 0.485085579788689 0.216013702225068 0.241491090198703 0.145539057329282 0.500366033906681 0.544342532400132 0.336871640155572 -0.419278718279615 -0.489664301927466 -0.424557577772267 0.121049759857373 0.140251287682838 -0.262131742580281 0.333292287228718 0.16709677336873 0.793042919931348 0.260393237078153 0.258725286402964 -0.865763346724695 -0.878472777415527 -3.88644255910488 -0.221370643813714 -0.00580506606525179 0.26022597668566 0.415194270705225 0.611397857931142 0.43678102807945 -0.36050838098809 0.463881457168909 0.415239890566046 -2.65199401656777 -2.35832775165555 -3.23796914694545 -0.0533042337026119 -0.304170077737805 -0.701942745972814 " 
               peanut_planting_proportion <- "-0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 1.4929807953722 2.04522469511636 2.04522469511636 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 0.781710160756411 0.908501300482927 1.60977702719488 -0.0497083606383063 -0.25249529646711 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 1.26212283468858 1.00271783564239 1.11109525970477 1.17247005451214 1.45770093464751 -0.295983148758026 -0.299591083384016 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 1.65681731809043 1.72643027343785 1.98027005733517 -0.270792840207123 -0.220536506940372 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 1.73974189544212 1.7259422551493 2.04522469511636 -0.0496816678632112 -0.048451254330504 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 -0.693620340834774 " 
               rice_harvesting_proportion <- "1.39518021807135 1.39518021807135 1.39518021807135 0.0791443646227185 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 0.901227765519708 1.2996143390774 1.17672685880149 0.94925576698438 0.0798719814979042 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 1.11756172005226 1.09369773457727 1.02409402086324 1.18108707609723 1.17089009160908 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 1.29321873598917 1.28349132192647 1.28583431497897 1.29236442834464 1.27409159661185 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 0.970711731860549 1.39518021807135 1.39518021807135 1.39518021807135 1.33398540043502 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 -0.816375165038537 1.39518021807135 " 
               covariateCollection <- tibble(
                 wind_speed = self$strToNum(wind_speed),
                 relat_humid_percent_variable_name = self$strToNum(relat_humid_percent_variable_name),
                 pre_mm_day_variable_name = self$strToNum(pre_mm_day_variable_name),
                 evi_variable_name = self$strToNum(evi_variable_name),
                 temp_celsius_variable_name = self$strToNum(temp_celsius_variable_name),
                 long_wave_radiation = self$strToNum(long_wave_radiation),
                 peanut_planting_proportion = self$strToNum(peanut_planting_proportion),
                 rice_harvesting_proportion = self$strToNum(rice_harvesting_proportion)
               )
               } else {
                 covariateCollection <- tibble(self$attributes$covariate)
               }
               return(covariateCollection)
             }
               
           )
)